{"version":3,"file":"index.es.js","sources":["../src/constants.js","../src/utils/storage.js","../src/hocs/withStep.js","../src/utils/search.js","../src/hooks/useActiveStepKey.js","../src/components/Stepper.js","../src/components/Step.js","../src/hooks/useResetSteps.js","../src/hooks/useCheckRouter.js","../src/index.js"],"sourcesContent":["export const STORAGE_KEY = 'REACT_JS_STEPPER_DATA';\r\nexport const HISTORY_STATE_KEY = 'ACTIVE_STEP_KEY';\r\n","import { STORAGE_KEY } from '../constants';\n\nconst initialStorage = { data: [], init: false };\n\nfunction getStorage() {\n    const rawData = sessionStorage.getItem(STORAGE_KEY);\n\n    return rawData ? JSON.parse(rawData) : initialStorage;\n}\n\nexport function issetStorage() {\n    return sessionStorage.getItem(STORAGE_KEY) !== null;\n}\n\nexport function initializeStorage() {\n    const storage = getStorage();\n\n    sessionStorage.setItem(STORAGE_KEY, JSON.stringify({ ...storage, init: true }));\n}\n\nexport function getData() {\n    const storage = getStorage();\n\n    return storage.data;\n}\n\nexport function addData(data) {\n    const storage = getStorage();\n\n    sessionStorage.setItem(STORAGE_KEY, JSON.stringify({ ...storage, data: { ...storage.data, ...data } }));\n}\n\nexport function clearStorage() {\n    sessionStorage.removeItem(STORAGE_KEY);\n}\n","import React from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { addData, getData, initializeStorage } from '../utils/storage';\nimport { HISTORY_STATE_KEY } from '../constants';\n\nexport default function withStep(Component, activeStepKey, nextStepKey) {\n    return (props) => {\n        const navigate = useNavigate();\n        const location = useLocation();\n\n        const allData = getData();\n        const stepData = allData[activeStepKey] || null;\n\n        const goToStepByKey = key => {\n            initializeStorage();\n\n            navigate(location.pathname, {\n                state: {\n                    ...location.state,\n                    [HISTORY_STATE_KEY]: key\n                }\n            });\n        };\n\n        const goToPrevStep = () => {\n            navigate(-1);\n        };\n\n        const goToNextStep = () => {\n            goToStepByKey(nextStepKey);\n        };\n\n        const saveAndGoToStepByKey = (data, key) => {\n            addData({ [activeStepKey]: data });\n            goToStepByKey(key);\n        };\n\n        const saveAndGoToPrevStep = data => {\n            addData({ [activeStepKey]: data });\n            goToPrevStep();\n        };\n\n        const saveAndGoToNextStep = data => {\n            addData({ [activeStepKey]: data });\n            goToNextStep();\n        };\n\n        return <Component { ...props } stepData={ stepData } allData={ allData }\n                          goToStepByKey={ goToStepByKey } saveAndGoToStepByKey={ saveAndGoToStepByKey }\n                          goToPrevStep={ goToPrevStep } saveAndGoToPrevStep={ saveAndGoToPrevStep }\n                          goToNextStep={ goToNextStep } saveAndGoToNextStep={ saveAndGoToNextStep }/>;\n    };\n}\n","export function getObjectByKey(objects, key) {\n    for (let object of objects) {\n        if (object.key === key) {\n            return object;\n        }\n    }\n\n    return null;\n}\n\nexport function getNextObjectByKey(objects, key) {\n    let objectsCount = objects.length;\n    let nextObject = objects[0];\n\n    for (let i = objectsCount - 1; i >= 0; i--) {\n        const object = objects[i];\n\n        if (object.key === key) {\n            break;\n        }\n\n        nextObject = object;\n    }\n\n    return nextObject;\n}\n\nexport function getPrevObjectByKey(objects, key) {\n    let objectsCount = objects.length;\n    let prevObject = objects[objectsCount - 1];\n\n    for (let i = 0; i < objectsCount; i++) {\n        const object = objects[i];\n\n        if (object.key === key) {\n            break;\n        }\n\n        prevObject = object;\n    }\n\n    return prevObject;\n}\n","import { useLocation } from 'react-router-dom';\r\nimport { HISTORY_STATE_KEY } from '../constants';\r\nimport { issetStorage } from '../utils/storage';\r\n\r\nexport default function useActiveStepKey(defaultStepKey) {\r\n    let { state } = useLocation();\r\n\r\n    if (!state) {\r\n        state = { [HISTORY_STATE_KEY]: defaultStepKey };\r\n    }\r\n\r\n    if (state[HISTORY_STATE_KEY] !== defaultStepKey && !issetStorage()) {\r\n        state = { [HISTORY_STATE_KEY]: defaultStepKey };\r\n    }\r\n\r\n    return state[HISTORY_STATE_KEY];\r\n}\r\n","import React, { useEffect } from 'react';\nimport withStep from '../hocs/withStep';\nimport { clearStorage } from '../utils/storage';\nimport { getObjectByKey, getNextObjectByKey } from '../utils/search';\nimport useActiveStepKey from '../hooks/useActiveStepKey';\n\n/**\n * @param {Step[]} steps\n * @param {boolean} [clearDataOnUnmount = true]\n * @returns {JSX.Element|boolean}\n * @constructor\n */\nexport default function Stepper({ steps, clearDataOnUnmount = true }) {\n    const firstStep = steps[0];\n    const firstStepKey = firstStep.key;\n\n    const activeStepKey = useActiveStepKey(firstStepKey);\n\n    useEffect(() => () => clearDataOnUnmount && clearStorage(), []);\n\n    const nextStep = getNextObjectByKey(steps, activeStepKey);\n    const activeStep = getObjectByKey(steps, activeStepKey);\n\n    if (!activeStep) {\n        return false;\n    }\n\n    const ActiveStepComponent = withStep(activeStep.component, activeStep.key, nextStep.key);\n\n    return <ActiveStepComponent { ...activeStep.props }/>;\n}\n","import React from 'react';\n\n/**\n * @param {React.Component} component\n * @param {string} [key]\n * @param {any[]} [props]\n * @returns {null}\n * @constructor\n */\nexport default function Step({ component, key, ...props }) {\n    return null;\n}\n","import { useLocation, useNavigate } from 'react-router-dom';\r\nimport { clearStorage } from '../utils/storage';\r\nimport { HISTORY_STATE_KEY } from '../constants';\r\n\r\nexport default function useResetSteps() {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n\r\n    return () => {\r\n        clearStorage();\r\n\r\n        navigate(location.pathname, {\r\n            state: {\r\n                ...location.state,\r\n                [HISTORY_STATE_KEY]: null\r\n            }\r\n        });\r\n    };\r\n}\r\n","import { useNavigate } from 'react-router-dom';\r\n\r\nexport default function useCheckRouter() {\r\n    const navigate = useNavigate();\r\n\r\n    if (!navigate) {\r\n        // help to correctly determine the presence <BrowserRouter/> in the tree components :)\r\n        throw new Error('<Stepper/> component must child the <BrowserRouter/> component');\r\n    }\r\n}\r\n","import React from 'react';\nimport Stepper from './components/Stepper';\nimport Step from './components/Step';\nimport useActiveStepKey from './hooks/useActiveStepKey';\nimport useResetSteps from './hooks/useResetSteps';\nimport useCheckRouter from './hooks/useCheckRouter';\n\nconst StepperWrapper = ({ children, ...props }) => {\n    useCheckRouter();\n\n    const steps = [];\n\n    React.Children.map(children, (child, index) => {\n        if (React.isValidElement(child) && child.type === Step) {\n            if (!('component' in child.props)) {\n                throw new Error('Not all <Step/> have the \"component\" prop');\n            }\n\n            const { component, ...props } = child.props;\n            const key = child.key || `step${ index + 1 }`;\n\n            steps.push({ component, key, props });\n        }\n    });\n\n    if (steps.length === 0) {\n        throw new Error('No one <Step/> found in <Stepper/>');\n    }\n\n    return <Stepper steps={ steps } { ...props }/>;\n};\n\nexport { StepperWrapper as Stepper, Step };\nexport { useActiveStepKey, useResetSteps };\n"],"names":["STORAGE_KEY","HISTORY_STATE_KEY","initialStorage","data","init","getStorage","rawData","sessionStorage","getItem","JSON","parse","issetStorage","initializeStorage","storage","setItem","stringify","getData","addData","clearStorage","removeItem","withStep","Component","activeStepKey","nextStepKey","props","navigate","useNavigate","location","useLocation","allData","stepData","goToStepByKey","key","pathname","state","goToPrevStep","goToNextStep","saveAndGoToStepByKey","saveAndGoToPrevStep","saveAndGoToNextStep","getObjectByKey","objects","object","getNextObjectByKey","objectsCount","length","nextObject","i","useActiveStepKey","defaultStepKey","Stepper","steps","clearDataOnUnmount","firstStep","firstStepKey","useEffect","nextStep","activeStep","ActiveStepComponent","component","Step","useResetSteps","useCheckRouter","Error","StepperWrapper","children","React","Children","map","child","index","isValidElement","type","push"],"mappings":"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"}