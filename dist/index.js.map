{"version":3,"file":"index.js","sources":["../src/components/Step.js","../src/utils/storage.js","../src/hoc/withStep.js","../src/utils/search.js","../src/components/Stepper.js"],"sourcesContent":["import React from 'react';\r\n\r\nexport default function Step() {\r\n    return null;\r\n}\r\n","const STEPPER_DATA_KEY = 'REACT_JS_STEPPER_DATA';\r\n\r\nconst initialStorage = { activeStepKey: null, data: [], init: false };\r\n\r\nfunction getStorage() {\r\n    const rawData = sessionStorage.getItem(STEPPER_DATA_KEY);\r\n\r\n    return rawData ? JSON.parse(rawData) : initialStorage;\r\n}\r\n\r\nexport function issetStorage() {\r\n    return sessionStorage.getItem(STEPPER_DATA_KEY) !== null;\r\n}\r\n\r\nexport function initializeStorage() {\r\n    const storage = getStorage();\r\n\r\n    sessionStorage.setItem(STEPPER_DATA_KEY, JSON.stringify({ ...storage, init: true }));\r\n}\r\n\r\nexport function getActiveStepKey() {\r\n    const storage = getStorage();\r\n\r\n    return storage.activeStepKey;\r\n}\r\n\r\nexport function setActiveStepKey(activeStepKey) {\r\n    const storage = getStorage();\r\n\r\n    sessionStorage.setItem(STEPPER_DATA_KEY, JSON.stringify({ ...storage, activeStepKey }));\r\n}\r\n\r\nexport function getData() {\r\n    const storage = getStorage();\r\n\r\n    return storage.data;\r\n}\r\n\r\nexport function addData(data) {\r\n    const storage = getStorage();\r\n\r\n    sessionStorage.setItem(STEPPER_DATA_KEY, JSON.stringify({ ...storage, data: { ...storage.data, ...data } }));\r\n}\r\n\r\nexport function clearStorage() {\r\n    sessionStorage.removeItem(STEPPER_DATA_KEY);\r\n}\r\n","import React from 'react';\r\nimport { useHistory, useLocation } from 'react-router-dom';\r\nimport { addData, getData, initializeStorage } from '../utils/storage';\r\n\r\nexport default function withStep(Component, activeStepKey, prevStepKey, nextStepKey) {\r\n    return (props) => {\r\n        const history = useHistory();\r\n        const location = useLocation();\r\n\r\n        const allData = getData();\r\n        const stepData = allData[activeStepKey] || null;\r\n\r\n        const goToStepByKey = key => {\r\n            initializeStorage();\r\n\r\n            history.push({\r\n                ...location,\r\n                state: {\r\n                    ...location.state,\r\n                    activeStepKey: key\r\n                }\r\n            });\r\n        };\r\n\r\n        const goToPrevStep = () => {\r\n            history.goBack();\r\n        };\r\n\r\n        const goToNextStep = () => {\r\n            goToStepByKey(nextStepKey);\r\n        };\r\n\r\n        const saveAndGoToStepByKey = (data, key) => {\r\n            addData({ [activeStepKey]: data });\r\n            goToStepByKey(key);\r\n        };\r\n\r\n        const saveAndGoToPrevStep = data => {\r\n            addData({ [activeStepKey]: data });\r\n            goToPrevStep();\r\n        };\r\n\r\n        const saveAndGoToNextStep = data => {\r\n            addData({ [activeStepKey]: data });\r\n            goToNextStep();\r\n        };\r\n\r\n        return <Component { ...props } stepData={ stepData } allData={ allData }\r\n                          goToStepByKey={ goToStepByKey } saveAndGoToStepByKey={ saveAndGoToStepByKey }\r\n                          goToPrevStep={ goToPrevStep } saveAndGoToPrevStep={ saveAndGoToPrevStep }\r\n                          goToNextStep={ goToNextStep } saveAndGoToNextStep={ saveAndGoToNextStep }/>;\r\n    };\r\n}\r\n","export function getObjectByKey(objects, key) {\r\n    for (let object of objects) {\r\n        if (object.key === key) {\r\n            return object;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function getNextObjectByKey(objects, key) {\r\n    let nextObject = objects[0];\r\n\r\n    for (let i = objects.length - 1; i >= 0; i--) {\r\n        const object = objects[i];\r\n\r\n        if (object.key === key) {\r\n            break;\r\n        }\r\n\r\n        nextObject = object;\r\n    }\r\n\r\n    return nextObject;\r\n}\r\n\r\nexport function getPrevObjectByKey(objects, key) {\r\n    let prevObject = objects[objects.length - 1];\r\n\r\n    for (let i = 0; i < objects.length; i++) {\r\n        const object = objects[i];\r\n\r\n        if (object.key === key) {\r\n            break;\r\n        }\r\n\r\n        prevObject = object;\r\n    }\r\n\r\n    return prevObject;\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport Step from './Step';\r\nimport withStep from '../hoc/withStep';\r\nimport { clearStorage, issetStorage } from '../utils/storage';\r\nimport { getObjectByKey, getNextObjectByKey, getPrevObjectByKey } from '../utils/search';\r\n\r\nexport default ({ children, ...props }) => {\r\n    const steps = [];\r\n\r\n    let i = 1;\r\n\r\n    React.Children.map(children, child => {\r\n        if (React.isValidElement(child) && child.type === Step) {\r\n            if (!('component' in child.props)) {\r\n                throw new Error('Not all <Step/> have the \"component\" prop');\r\n            }\r\n\r\n            const { component, ...props } = child.props;\r\n            const key = child.key || `step${ i }`;\r\n\r\n            steps.push({ component, key, props });\r\n\r\n            i++;\r\n        }\r\n    });\r\n\r\n    if (steps.length === 0) {\r\n        throw new Error('No one <Step/> found in <Stepper/>');\r\n    }\r\n\r\n    return <Stepper steps={ steps } { ...props }/>;\r\n}\r\n\r\nfunction Stepper({ steps, clearDataOnUnmount = true }) {\r\n    let { state } = useLocation();\r\n\r\n    useEffect(() => () => clearDataOnUnmount && clearStorage(), []);\r\n\r\n    if (!state) {\r\n        state = { activeStepKey: steps[0].key };\r\n    }\r\n\r\n    if (state.activeStepKey !== steps[0].key && !issetStorage()) {\r\n        state = { activeStepKey: steps[0].key };\r\n    }\r\n\r\n    const activeStepKey = state.activeStepKey;\r\n\r\n    const prevStep = getPrevObjectByKey(steps, activeStepKey);\r\n    const nextStep = getNextObjectByKey(steps, activeStepKey);\r\n    const activeStep = getObjectByKey(steps, activeStepKey);\r\n\r\n    if (!activeStep) {\r\n        return false;\r\n    }\r\n\r\n    const ActiveStepComponent = withStep(activeStep.component, activeStep.key, prevStep.key, nextStep.key);\r\n\r\n    return <ActiveStepComponent { ...activeStep.props }/>;\r\n}\r\n"],"names":["Step","STEPPER_DATA_KEY","initialStorage","activeStepKey","data","init","getStorage","rawData","sessionStorage","getItem","JSON","parse","issetStorage","initializeStorage","storage","setItem","stringify","getData","addData","clearStorage","removeItem","withStep","Component","prevStepKey","nextStepKey","props","history","useHistory","location","useLocation","allData","stepData","goToStepByKey","key","push","state","goToPrevStep","goBack","goToNextStep","saveAndGoToStepByKey","saveAndGoToPrevStep","saveAndGoToNextStep","React","getObjectByKey","objects","object","getNextObjectByKey","nextObject","i","length","getPrevObjectByKey","prevObject","children","steps","Children","map","child","isValidElement","type","Error","component","Stepper","clearDataOnUnmount","useEffect","prevStep","nextStep","activeStep","ActiveStepComponent"],"mappings":"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"}